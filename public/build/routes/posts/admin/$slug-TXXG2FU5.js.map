{
  "version": 3,
  "sources": ["../../../../../app/routes/posts/admin/$slug.tsx"],
  "sourcesContent": ["import {\n  Form,\n  Link,\n  useActionData,\n  useLoaderData,\n  useParams,\n  useTransition,\n} from \"@remix-run/react\";\nimport { redirect, json } from \"@remix-run/node\";\nimport type { ActionFunction, LoaderFunction } from \"@remix-run/node\";\nimport {\n  createPost,\n  deletePost,\n  getPost,\n  updatePost,\n} from \"~/models/post.server\";\nimport invariant from \"tiny-invariant\";\nimport type { Post } from \"~/models/post.server\";\nimport authenticator from \"~/services/auth.server\";\nimport { useState } from \"react\";\nimport { marked } from \"marked\";\ntype LoaderData = { post?: Post; html?: string };\n\nexport const loader: LoaderFunction = async ({ request, params }) => {\n  await authenticator.isAuthenticated(request, {\n    failureRedirect: \"/login\",\n  });\n  if (params.slug === \"new\") {\n    return json<LoaderData>({});\n  }\n\n  const post = await getPost(params.slug || \"\");\n  if (!post) {\n    return redirect(\"/posts/admin\");\n  }\n  const html = marked(post.markdown);\n  return json<LoaderData>({ post, html });\n};\n\ntype ActionData =\n  | {\n      title: null | string;\n      slug: null | string;\n      markdown: null | string;\n    }\n  | undefined;\n\nexport const action: ActionFunction = async ({ request, params }) => {\n  invariant(params.slug, \"slug is required\");\n  const formData = await request.formData();\n  const intent = formData.get(\"intent\");\n  if (intent === \"delete\") {\n    await deletePost(params.slug);\n    return redirect(\"/posts/admin\");\n  } else if (intent === \"cancel\") {\n    return redirect(\"/posts/admin\");\n  }\n\n  //returns values one by one\n  //to get all values - formData.getAll(); returns all data values\n  const title = formData.get(\"title\");\n  const slug = formData.get(\"slug\");\n  const markdown = formData.get(\"markdown\");\n\n  const errors: ActionData = {\n    title: title ? null : \"Title is required\",\n    slug:\n      slug && slug !== \"new\" ? null : \"Slug is required. Cannot set this slug\",\n    markdown: markdown ? null : \"Markdown is required\",\n  };\n\n  const hasErrors = Object.values(errors).some((errorMessage) => errorMessage);\n\n  if (hasErrors) {\n    return json<ActionData>(errors);\n  }\n\n  invariant(typeof title === \"string\", \"title must be a string\");\n  invariant(typeof slug === \"string\", \"slug must be a string\");\n  invariant(typeof markdown === \"string\", \"markdown must be a string\");\n\n  if (params.slug === \"new\") {\n    await createPost({ title, slug, markdown });\n  } else {\n    await updatePost(params.slug, { title, slug, markdown });\n  }\n  return redirect(\"/posts/admin\");\n};\n\nconst inputClassName = `w-full rounded border border-gray-500 px-2 py-1 text-lg`;\n\nexport default function NewPost() {\n  const [isEditMode, setIsEditMode] = useState(true);\n  const handleCreateNewPost = () => {\n    location.href = \"/posts/admin/new\";\n  };\n  const { post, html } = useLoaderData() as LoaderData;\n  const errors = useActionData() as ActionData;\n  const transition = useTransition();\n  const isCreating = transition.submission?.formData.get(\"intent\") === \"create\";\n  const isUpdating = transition.submission?.formData.get(\"intent\") === \"update\";\n  const isDeleting = transition.submission?.formData.get(\"intent\") === \"delete\";\n  const isCancelling =\n    transition.submission?.formData.get(\"intent\") === \"cancel\";\n  const isNewPost = !post;\n  const urlParams = useParams();\n\n  return (\n    <>\n      {isEditMode ? (\n        <div className=\"mx-8\">\n          <Form method=\"post\" key={post?.slug ?? \"new\"}>\n            <p>\n              Tip:{\" \"}\n              <em>\n                You've entered Edit mode. If the fields are empty but you want\n                to edit any post, just click on any post on the left and you\n                will be given access to edit the post.\n              </em> <br />\n            {urlParams.slug !== \"new\" ?<button><Link to=\"/new\">New post</Link></button> : null}\n            </p>\n            <br />\n            <div className=\"flex justify-between\">\n              <div>\n                <label>\n                  Post Title:\n                  {errors?.title ? (\n                    <em className=\"text-red-600\">{errors.title}</em>\n                  ) : null}\n                  <input\n                    type=\"text\"\n                    name=\"title\"\n                    className={inputClassName}\n                    defaultValue={post?.slug && post?.title}\n                  />\n                </label>\n              </div>\n              <div>\n                <label>\n                  Post Slug:\n                  {errors?.slug ? (\n                    <em className=\"text-red-600\">{errors.slug}</em>\n                  ) : null}\n                  <input\n                    type=\"text\"\n                    name=\"slug\"\n                    className={inputClassName}\n                    defaultValue={post?.slug && post?.slug}\n                  />\n                </label>\n              </div>\n            </div>\n            <div>\n              <label htmlFor=\"markdown\">\n                Markdown:\n                {errors?.markdown ? (\n                  <em className=\"text-red-600\">{errors.markdown}</em>\n                ) : null}\n              </label>\n              <textarea\n                id=\"markdown\"\n                rows={20}\n                name=\"markdown\"\n                className={`${inputClassName} font-mono`}\n                defaultValue={post?.slug && post?.markdown}\n              />\n            </div>\n            <div className=\"flex justify-end gap-4\">\n              <button\n                onClick={() => setIsEditMode(false)}\n                className=\"rounded bg-yellow-500 py-2 px-4 text-white hover:bg-yellow-600 focus:bg-yellow-400 disabled:bg-yellow-300\"\n              >\n                {isCancelling ? \"Cancelling...\" : \"Cancel\"}\n              </button>\n              {isNewPost ? null : (\n                <button\n                  type=\"submit\"\n                  name=\"intent\"\n                  value=\"delete\"\n                  className=\"rounded bg-red-500 py-2 px-4 text-white hover:bg-red-600 focus:bg-red-400 disabled:bg-red-300\"\n                  disabled={isDeleting}\n                >\n                  {isDeleting ? \"Deleting...\" : \"Delete\"}\n                </button>\n              )}\n              <button\n                type=\"submit\"\n                name=\"intent\"\n                value={isNewPost ? \"create\" : \"update\"}\n                className=\"rounded bg-blue-500 py-2 px-4 text-white hover:bg-blue-600 focus:bg-blue-400 disabled:bg-blue-300\"\n                disabled={isCreating || isUpdating}\n              >\n                {isNewPost\n                  ? isCreating\n                    ? \"Creating...\"\n                    : \"Create Post\"\n                  : null}\n                {isNewPost ? null : isUpdating ? \"Updating...\" : \"Update\"}\n              </button>\n            </div>\n          </Form>\n        </div>\n      ) : (\n        <main className=\"mx-auto max-w-4xl\">\n          <div className=\"flex items-center justify-between\">\n            <h1 className=\"my-6 text-3xl\">{post?.title}</h1>\n            <div>\n              <button\n                onClick={() => setIsEditMode(true)}\n                className=\"mb-2 w-40 rounded bg-yellow-500 p-2 text-white hover:bg-yellow-600 focus:bg-yellow-400 disabled:bg-yellow-300\"\n              >\n                Edit mode\n              </button>\n              <br />\n              <button\n                onClick={() => handleCreateNewPost()}\n                className=\"w-40 rounded bg-green-600 p-2 text-white\"\n              >\n                Create a new Post\n              </button>\n            </div>\n          </div>\n          <div dangerouslySetInnerHTML={{ __html: html || \"\" }} />\n        </main>\n      )}\n    </>\n  );\n}\n"],
  "mappings": "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",
  "names": ["import_react"]
}
